#include <assert.h>
#include <stdint.h>
#include <ap_axi_sdata.h>

#define BATCH_SIZE 10
#define NUM_KERNELS 16

typedef ap_axiu<16,4,5,5> AXI_VAL_int16;
typedef ap_axiu<8,4,5,5> AXI_VAL_uint8;
//typedef ap_axiu<8,4,5,5> AXI_VAL_int8;

// --------------------------------------------------------
// functions to insert and extract elements from an axi stream
// includes conversion to correct data type

/*
ap_axi_sdata.h::

#include "ap_int.h"

template<int D,int U,int TI,int TD>
struct ap_axis{
 ap_int<D>    data;
 ap_uint<D/8> keep;
 ap_uint<D/8> strb;
 ap_uint<U>   user;
 ap_uint<1>   last;
 ap_uint<TI>  id;
 ap_uint<TD>  dest;
};
 */


const int8_t popcount_lut_8[256] = {-8, -6, -6, -4, -6, -4, -4, -2, -6, -4, -4, -2, -4, -2, -2, 0, -6, -4, -4, -2, -4, -2, -2, 0, -4, -2, -2, 0, -2, 0, 0, 2, -6, -4, -4, -2, -4, -2, -2, 0, -4, -2, -2, 0, -2, 0, 0, 2, -4, -2, -2, 0, -2, 0, 0, 2, -2, 0, 0, 2, 0, 2, 2, 4, -6, -4, -4, -2, -4, -2, -2, 0, -4, -2, -2, 0, -2, 0, 0, 2, -4, -2, -2, 0, -2, 0, 0, 2, -2, 0, 0, 2, 0, 2, 2, 4, -4, -2, -2, 0, -2, 0, 0, 2, -2, 0, 0, 2, 0, 2, 2, 4, -2, 0, 0, 2, 0, 2, 2, 4, 0, 2, 2, 4, 2, 4, 4, 6, -6, -4, -4, -2, -4, -2, -2, 0, -4, -2, -2, 0, -2, 0, 0, 2, -4, -2, -2, 0, -2, 0, 0, 2, -2, 0, 0, 2, 0, 2, 2, 4, -4, -2, -2, 0, -2, 0, 0, 2, -2, 0, 0, 2, 0, 2, 2, 4, -2, 0, 0, 2, 0, 2, 2, 4, 0, 2, 2, 4, 2, 4, 4, 6, -4, -2, -2, 0, -2, 0, 0, 2, -2, 0, 0, 2, 0, 2, 2, 4, -2, 0, 0, 2, 0, 2, 2, 4, 0, 2, 2, 4, 2, 4, 4, 6, -2, 0, 0, 2, 0, 2, 2, 4, 0, 2, 2, 4, 2, 4, 4, 6, 0, 2, 2, 4, 2, 4, 4, 6, 2, 4, 4, 6, 4, 6, 6, 8}
;


const int8_t popcount_lut_9[512] = {-16, -14, -14, -12, -14, -12, -12, -10, -14, -12, -12, -10, -12, -10, -10, -8, -14, -12, -12, -10, -12, -10, -10, -8, -12, -10, -10, -8, -10, -8, -8, -6, -14, -12, -12, -10, -12, -10, -10, -8, -12, -10, -10, -8, -10, -8, -8, -6, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -14, -12, -12, -10, -12, -10, -10, -8, -12, -10, -10, -8, -10, -8, -8, -6, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -14, -12, -12, -10, -12, -10, -10, -8, -12, -10, -10, -8, -10, -8, -8, -6, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -8, -6, -6, -4, -6, -4, -4, -2, -6, -4, -4, -2, -4, -2, -2, 0, -14, -12, -12, -10, -12, -10, -10, -8, -12, -10, -10, -8, -10, -8, -8, -6, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -8, -6, -6, -4, -6, -4, -4, -2, -6, -4, -4, -2, -4, -2, -2, 0, -12, -10, -10, -8, -10, -8, -8, -6, -10, -8, -8, -6, -8, -6, -6, -4, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -8, -6, -6, -4, -6, -4, -4, -2, -6, -4, -4, -2, -4, -2, -2, 0, -10, -8, -8, -6, -8, -6, -6, -4, -8, -6, -6, -4, -6, -4, -4, -2, -8, -6, -6, -4, -6, -4, -4, -2, -6, -4, -4, -2, -4, -2, -2, 0, -8, -6, -6, -4, -6, -4, -4, -2, -6, -4, -4, -2, -4, -2, -2, 0, -6, -4, -4, -2, -4, -2, -2, 0, -4, -2, -2, 0, -2, 0, 0, 2}
;

static const uint16_t conv1_kernels[16] = { 
    65112, 65496, 65031, 65042, 65171, 65488, 65468, 65520, 65414, 65252, 65332, 65463, 65191, 65280, 65508, 65384
};

static const uint16_t conv2_kernels[16][16] = {
	{65232, 65508, 65440, 65115, 65453, 65512, 65040, 65295, 65034, 65040, 65311, 65404, 65504, 65512, 65246, 65112},
	{65521, 65076, 65082, 65325, 65481, 65040, 65280, 65480, 65055, 65344, 65527, 65272, 65080, 65044, 65202, 65398},
	{65051, 65507, 65444, 65113, 65335, 65509, 65103, 65320, 65488, 65209, 65046, 65447, 65255, 65447, 65093, 65035},
	{65168, 65535, 65321, 65225, 65335, 65328, 65533, 65287, 65217, 65242, 65108, 65471, 65528, 65112, 65028, 65103},
	{65115, 65333, 65457, 65097, 65385, 65433, 65235, 65280, 65488, 65225, 65044, 65447, 65163, 65497, 65093, 65101},
	{65356, 65025, 65531, 65047, 65030, 65216, 65375, 65135, 65055, 65216, 65039, 65052, 65280, 65481, 65247, 65144},
	{65519, 65178, 65115, 65318, 65482, 65206, 65280, 65278, 65335, 65318, 65455, 65112, 65289, 65079, 65534, 65328},
	{65184, 65041, 65051, 65446, 65480, 65040, 65345, 65238, 65071, 65476, 65257, 65048, 65336, 65030, 65469, 65508},
	{65064, 65183, 65503, 65318, 65028, 65529, 65262, 65035, 65487, 65529, 65147, 65047, 65151, 65499, 65243, 65483},
	{65024, 65240, 65241, 65334, 65078, 65512, 65118, 65103, 65087, 65224, 65035, 65471, 65232, 65241, 65119, 65097},
	{65509, 65027, 65263, 65510, 65076, 65225, 65375, 65047, 65285, 65337, 65471, 65338, 65472, 65261, 65483, 65369},
	{65519, 65152, 65414, 65388, 65088, 65063, 65044, 65456, 65520, 65082, 65530, 65248, 65031, 65471, 65392, 65408},
	{65125, 65171, 65223, 65094, 65072, 65063, 65303, 65144, 65504, 65451, 65448, 65287, 65095, 65079, 65409, 65445},
	{65024, 65535, 65129, 65170, 65463, 65288, 65535, 65431, 65223, 65482, 65024, 65339, 65400, 65224, 65057, 65271},
	{65220, 65529, 65097, 65444, 65526, 65092, 65446, 65227, 65071, 65379, 65515, 65147, 65340, 65029, 65320, 65505},
	{65456, 65038, 65053, 65171, 65113, 65074, 65535, 65231, 65087, 65477, 65133, 65240, 65320, 65124, 65078, 65460}
};

static const uint8_t fc_weights[10][288] = {
	{24, 71, 255, 121, 237, 70, 193, 54, 3, 248, 55, 131, 248, 15, 67, 255, 126, 57, 196, 2, 246, 71, 37, 29, 200, 247, 206, 191, 196, 248, 23, 129, 116, 0, 0, 253, 11, 163, 142, 185, 239, 154, 161, 0, 80, 129, 6, 144, 111, 87, 225, 183, 216, 24, 229, 3, 255, 223, 197, 20, 210, 31, 36, 244, 79, 140, 186, 131, 42, 11, 232, 4, 21, 21, 28, 31, 177, 173, 35, 133, 60, 129, 15, 0, 129, 0, 33, 0, 97, 242, 21, 13, 188, 127, 239, 207, 240, 119, 67, 255, 182, 240, 158, 38, 96, 35, 143, 63, 79, 255, 179, 112, 26, 161, 135, 24, 124, 135, 200, 121, 134, 65, 43, 72, 231, 252, 200, 234, 0, 227, 10, 245, 142, 170, 198, 12, 245, 143, 72, 205, 192, 189, 9, 225, 8, 121, 237, 56, 255, 255, 166, 113, 227, 30, 33, 254, 1, 116, 47, 160, 236, 6, 31, 160, 31, 193, 154, 196, 128, 80, 101, 14, 64, 236, 12, 244, 59, 238, 167, 133, 212, 80, 40, 143, 232, 156, 249, 135, 131, 248, 127, 135, 120, 195, 124, 7, 192, 113, 103, 3, 162, 126, 7, 192, 248, 7, 180, 113, 142, 56, 243, 15, 56, 65, 241, 254, 7, 70, 254, 25, 255, 7, 248, 247, 20, 83, 4, 112, 7, 2, 126, 3, 68, 125, 172, 7, 76, 125, 225, 7, 252, 59, 195, 46, 56, 249, 15, 244, 66, 246, 45, 223, 224, 94, 32, 67, 96, 127, 159, 247, 199, 124, 119, 134, 144, 201, 220, 7, 128, 224, 111, 199, 179, 238, 244, 15, 231, 8, 96, 14, 0, 224, 204, 8, 76, 193, 107, 252},
	{224, 15, 99, 191, 214, 206, 205, 214, 203, 204, 29, 139, 159, 237, 255, 99, 63, 223, 61, 155, 254, 135, 140, 48, 6, 51, 103, 126, 122, 119, 32, 119, 14, 120, 167, 101, 65, 90, 0, 14, 10, 230, 203, 202, 43, 222, 29, 140, 159, 193, 216, 214, 156, 208, 240, 187, 243, 158, 4, 196, 192, 38, 145, 125, 135, 216, 77, 60, 202, 169, 14, 179, 140, 106, 251, 15, 32, 225, 30, 128, 229, 60, 10, 226, 7, 57, 126, 225, 215, 127, 139, 160, 254, 39, 215, 187, 249, 117, 11, 24, 247, 140, 241, 134, 24, 6, 0, 130, 136, 39, 251, 115, 103, 191, 117, 231, 222, 61, 199, 255, 255, 232, 247, 127, 200, 240, 241, 18, 14, 67, 174, 48, 99, 9, 56, 227, 142, 33, 70, 10, 125, 227, 232, 205, 2, 131, 118, 96, 251, 158, 11, 245, 61, 227, 140, 30, 8, 226, 254, 255, 192, 0, 143, 172, 14, 97, 139, 52, 97, 159, 48, 195, 146, 59, 231, 10, 98, 95, 47, 23, 255, 255, 6, 232, 76, 32, 196, 8, 32, 194, 24, 33, 128, 28, 141, 240, 30, 1, 127, 227, 209, 126, 15, 226, 92, 63, 195, 124, 119, 199, 225, 227, 138, 112, 73, 126, 14, 149, 254, 47, 24, 115, 117, 255, 128, 184, 109, 10, 121, 167, 26, 48, 101, 250, 3, 0, 106, 115, 235, 26, 241, 247, 143, 209, 29, 29, 225, 142, 20, 6, 11, 128, 129, 190, 159, 224, 100, 0, 67, 9, 48, 243, 158, 48, 192, 46, 39, 224, 239, 64, 30, 199, 8, 255, 63, 255, 251, 243, 186, 27, 255, 184, 251, 129, 252, 63, 205, 248},
	{223, 253, 253, 131, 224, 251, 0, 0, 0, 0, 21, 12, 123, 15, 240, 191, 206, 240, 160, 34, 2, 192, 54, 221, 123, 207, 113, 239, 30, 89, 47, 125, 255, 0, 249, 0, 27, 231, 191, 63, 239, 252, 255, 25, 161, 17, 244, 31, 128, 183, 239, 111, 168, 16, 254, 252, 143, 179, 18, 124, 3, 160, 56, 131, 239, 190, 103, 223, 55, 3, 124, 170, 32, 56, 78, 1, 245, 121, 183, 4, 128, 104, 13, 3, 59, 251, 255, 159, 253, 254, 254, 30, 21, 233, 244, 15, 1, 184, 13, 255, 15, 168, 255, 64, 120, 7, 12, 240, 228, 248, 3, 182, 31, 103, 254, 255, 254, 163, 224, 18, 0, 64, 4, 224, 23, 143, 0, 3, 128, 24, 5, 128, 112, 77, 2, 44, 209, 141, 93, 51, 127, 177, 243, 28, 255, 119, 255, 117, 255, 255, 248, 254, 125, 47, 134, 64, 0, 0, 32, 248, 0, 0, 15, 43, 228, 62, 7, 16, 52, 23, 195, 169, 240, 27, 129, 240, 31, 48, 119, 10, 21, 0, 248, 67, 128, 8, 0, 128, 0, 31, 87, 255, 127, 255, 247, 46, 240, 251, 160, 120, 3, 3, 24, 0, 159, 0, 60, 157, 191, 63, 255, 255, 255, 238, 125, 255, 101, 138, 23, 193, 232, 189, 3, 27, 240, 255, 15, 240, 239, 11, 192, 6, 14, 241, 255, 147, 145, 120, 164, 15, 64, 255, 79, 255, 227, 192, 29, 8, 64, 0, 11, 249, 65, 33, 16, 105, 36, 6, 99, 224, 12, 15, 223, 225, 127, 22, 195, 240, 121, 79, 193, 128, 62, 55, 243, 239, 124, 95, 192, 124, 6, 0, 8, 149, 219, 15, 183, 255},
	{157, 238, 253, 3, 224, 47, 1, 208, 29, 129, 252, 62, 64, 32, 4, 0, 193, 228, 251, 122, 147, 0, 70, 0, 255, 151, 227, 252, 251, 245, 29, 192, 153, 127, 7, 25, 219, 161, 255, 31, 197, 254, 94, 244, 15, 113, 247, 216, 59, 131, 79, 33, 246, 230, 213, 255, 15, 129, 104, 56, 1, 114, 30, 59, 240, 13, 0, 212, 29, 3, 229, 118, 98, 140, 162, 144, 15, 225, 124, 15, 192, 189, 129, 249, 142, 11, 64, 118, 79, 121, 249, 120, 31, 1, 240, 15, 7, 16, 113, 1, 120, 51, 0, 112, 35, 142, 240, 95, 250, 92, 65, 152, 31, 193, 124, 119, 199, 252, 23, 193, 124, 55, 177, 32, 56, 2, 179, 97, 192, 120, 31, 16, 195, 12, 112, 142, 6, 233, 200, 44, 8, 113, 15, 232, 136, 203, 255, 31, 243, 254, 127, 63, 225, 58, 35, 207, 127, 227, 246, 0, 30, 1, 3, 75, 208, 127, 7, 188, 127, 175, 224, 254, 103, 240, 124, 139, 204, 125, 129, 196, 0, 19, 218, 3, 4, 24, 3, 196, 28, 3, 208, 27, 64, 230, 2, 103, 198, 252, 128, 240, 5, 128, 8, 0, 128, 10, 31, 17, 176, 0, 0, 0, 40, 131, 252, 63, 254, 248, 30, 129, 232, 121, 49, 31, 215, 97, 248, 191, 31, 144, 97, 223, 96, 23, 223, 50, 7, 32, 226, 30, 83, 248, 41, 130, 52, 31, 32, 121, 143, 61, 112, 3, 200, 124, 238, 67, 148, 60, 67, 204, 120, 135, 8, 63, 0, 229, 30, 219, 78, 233, 224, 251, 63, 29, 115, 135, 122, 47, 238, 245, 119, 255, 127, 195, 227, 28, 96, 7},
	{252, 124, 1, 192, 31, 129, 250, 95, 189, 255, 171, 254, 223, 220, 255, 184, 62, 7, 0, 81, 254, 127, 235, 254, 127, 136, 144, 16, 112, 6, 216, 111, 199, 63, 225, 252, 240, 252, 1, 64, 0, 0, 129, 35, 241, 251, 42, 120, 226, 201, 158, 158, 19, 241, 224, 18, 232, 190, 55, 161, 240, 181, 125, 205, 216, 253, 143, 27, 241, 254, 50, 9, 55, 187, 254, 255, 247, 145, 203, 25, 17, 120, 50, 28, 114, 191, 159, 64, 25, 153, 15, 35, 237, 191, 195, 254, 255, 207, 255, 176, 219, 128, 184, 9, 220, 161, 92, 0, 63, 131, 249, 31, 192, 248, 7, 96, 35, 0, 120, 195, 54, 55, 254, 127, 195, 252, 236, 48, 12, 1, 250, 30, 9, 128, 220, 63, 239, 255, 51, 232, 56, 129, 231, 127, 8, 0, 57, 228, 44, 110, 44, 211, 131, 240, 57, 19, 248, 198, 127, 63, 243, 247, 119, 251, 191, 0, 112, 108, 132, 120, 111, 13, 36, 199, 64, 44, 2, 215, 166, 55, 210, 62, 7, 240, 191, 7, 157, 75, 212, 253, 201, 222, 183, 141, 2, 184, 42, 131, 95, 129, 252, 63, 229, 255, 101, 5, 155, 72, 247, 111, 126, 103, 224, 60, 32, 124, 31, 135, 250, 127, 207, 245, 126, 254, 17, 24, 38, 0, 144, 35, 223, 112, 11, 205, 62, 85, 39, 135, 212, 95, 191, 251, 222, 117, 205, 243, 232, 15, 139, 79, 254, 129, 144, 14, 63, 95, 255, 206, 28, 195, 220, 189, 131, 210, 63, 46, 51, 200, 95, 191, 63, 211, 229, 0, 8, 193, 204, 56, 98, 4, 51, 138, 56, 239, 222, 80, 139, 216},
	{3, 225, 241, 191, 23, 249, 255, 135, 212, 30, 240, 79, 0, 112, 47, 2, 192, 236, 120, 183, 9, 96, 80, 93, 142, 200, 255, 3, 246, 223, 195, 206, 72, 67, 8, 1, 173, 247, 255, 251, 255, 143, 39, 159, 190, 185, 243, 0, 43, 0, 202, 65, 77, 11, 219, 244, 192, 31, 103, 222, 251, 100, 113, 3, 48, 114, 128, 8, 9, 96, 197, 9, 14, 77, 128, 192, 0, 126, 11, 243, 255, 63, 249, 254, 161, 78, 0, 119, 97, 252, 208, 254, 131, 254, 14, 208, 220, 9, 132, 8, 248, 119, 10, 48, 35, 140, 239, 145, 189, 95, 222, 199, 204, 112, 128, 136, 31, 101, 159, 217, 251, 63, 254, 128, 222, 4, 79, 66, 62, 129, 192, 253, 46, 242, 231, 92, 64, 6, 193, 245, 72, 112, 8, 179, 228, 88, 0, 144, 8, 0, 0, 8, 12, 235, 247, 239, 255, 247, 255, 215, 94, 235, 252, 19, 95, 131, 248, 225, 0, 10, 126, 247, 23, 176, 125, 215, 239, 60, 16, 119, 1, 152, 59, 89, 123, 191, 26, 51, 225, 138, 0, 64, 1, 48, 119, 23, 225, 255, 251, 223, 212, 255, 255, 254, 251, 252, 111, 130, 24, 68, 130, 128, 32, 131, 149, 63, 121, 255, 129, 248, 30, 92, 198, 201, 31, 131, 255, 115, 143, 24, 113, 167, 239, 113, 172, 245, 123, 136, 30, 0, 230, 8, 0, 128, 40, 47, 9, 112, 199, 92, 95, 61, 220, 28, 159, 128, 29, 97, 192, 24, 64, 196, 0, 7, 1, 231, 71, 46, 111, 255, 221, 184, 192, 206, 12, 48, 135, 192, 191, 171, 241, 255, 31, 240, 169, 31, 220, 127},
	{64, 51, 1, 64, 76, 0, 228, 119, 135, 126, 191, 240, 126, 143, 224, 79, 159, 107, 255, 211, 240, 254, 31, 231, 255, 247, 254, 167, 200, 62, 2, 200, 63, 64, 208, 3, 128, 72, 0, 129, 237, 158, 1, 242, 30, 153, 139, 140, 249, 253, 14, 209, 247, 47, 63, 67, 130, 213, 154, 162, 123, 63, 173, 127, 199, 220, 117, 211, 24, 0, 5, 2, 159, 26, 6, 168, 115, 135, 24, 219, 140, 209, 198, 36, 34, 2, 41, 47, 152, 185, 31, 227, 240, 126, 15, 224, 254, 31, 243, 254, 106, 116, 143, 38, 0, 112, 7, 245, 1, 0, 98, 71, 245, 255, 3, 208, 112, 129, 12, 0, 192, 12, 1, 120, 35, 103, 111, 179, 252, 86, 188, 0, 64, 8, 83, 134, 112, 194, 127, 3, 248, 31, 176, 148, 47, 116, 13, 75, 189, 112, 154, 120, 63, 1, 240, 29, 193, 252, 6, 80, 31, 57, 211, 248, 2, 0, 32, 82, 7, 240, 57, 1, 144, 91, 133, 252, 123, 238, 243, 71, 191, 251, 222, 255, 21, 128, 112, 7, 163, 62, 63, 250, 191, 227, 255, 15, 192, 43, 127, 7, 240, 255, 231, 255, 255, 247, 240, 118, 39, 10, 227, 182, 14, 17, 147, 124, 99, 222, 66, 16, 3, 179, 103, 191, 228, 173, 136, 120, 71, 140, 36, 193, 94, 58, 7, 224, 254, 95, 11, 240, 190, 27, 225, 134, 26, 118, 223, 26, 72, 112, 102, 137, 255, 243, 247, 95, 31, 0, 114, 11, 227, 254, 55, 126, 15, 208, 248, 23, 136, 64, 128, 56, 192, 163, 245, 255, 21, 240, 157, 129, 156, 48, 192, 60, 3, 195, 127, 233},
	{105, 51, 241, 255, 231, 247, 127, 246, 61, 1, 64, 80, 143, 147, 252, 124, 159, 255, 68, 75, 128, 152, 96, 32, 10, 1, 184, 127, 191, 254, 250, 214, 161, 254, 53, 82, 140, 75, 240, 191, 7, 246, 219, 171, 182, 104, 23, 32, 100, 24, 129, 1, 159, 235, 68, 70, 0, 4, 4, 65, 71, 130, 94, 237, 171, 251, 254, 109, 230, 220, 11, 254, 207, 209, 13, 255, 125, 224, 78, 15, 241, 247, 15, 124, 49, 222, 63, 26, 124, 1, 148, 143, 1, 128, 248, 6, 16, 22, 29, 71, 48, 97, 72, 31, 143, 249, 253, 31, 127, 43, 255, 186, 97, 239, 12, 81, 231, 62, 87, 239, 255, 239, 254, 159, 225, 119, 79, 253, 245, 65, 55, 254, 252, 46, 16, 128, 252, 14, 163, 252, 9, 1, 12, 0, 191, 232, 64, 95, 195, 127, 92, 247, 129, 56, 51, 230, 215, 64, 191, 47, 239, 255, 80, 79, 200, 255, 175, 252, 113, 228, 140, 24, 105, 135, 1, 12, 48, 130, 1, 216, 182, 248, 0, 193, 12, 2, 195, 172, 26, 225, 246, 15, 2, 200, 0, 176, 7, 64, 223, 120, 63, 0, 0, 0, 6, 1, 248, 91, 247, 252, 255, 255, 239, 124, 39, 3, 112, 52, 128, 132, 64, 32, 17, 20, 113, 119, 23, 120, 184, 59, 195, 249, 241, 46, 129, 167, 64, 129, 168, 54, 65, 48, 30, 4, 240, 193, 201, 79, 191, 123, 240, 191, 127, 192, 18, 161, 2, 14, 7, 232, 88, 73, 177, 14, 0, 197, 0, 248, 7, 176, 191, 28, 222, 6, 48, 95, 124, 183, 195, 252, 61, 198, 29, 239, 159, 57, 224, 28},
	{48, 24, 0, 129, 36, 10, 255, 23, 243, 159, 104, 98, 124, 31, 128, 112, 28, 8, 22, 0, 118, 148, 208, 10, 128, 224, 2, 1, 246, 31, 105, 192, 158, 135, 200, 244, 61, 224, 223, 7, 229, 99, 54, 68, 98, 46, 120, 201, 132, 12, 32, 166, 248, 94, 230, 35, 38, 223, 167, 252, 255, 240, 63, 8, 255, 207, 252, 199, 128, 1, 32, 6, 251, 182, 11, 213, 236, 0, 192, 8, 6, 192, 254, 127, 175, 192, 15, 65, 114, 250, 196, 223, 130, 248, 103, 102, 211, 82, 48, 251, 135, 191, 255, 231, 254, 0, 79, 4, 247, 108, 35, 64, 8, 0, 128, 8, 0, 96, 60, 0, 0, 28, 1, 192, 23, 71, 28, 99, 118, 60, 150, 229, 208, 199, 45, 243, 133, 105, 222, 53, 194, 254, 8, 254, 77, 152, 194, 2, 121, 14, 17, 62, 1, 6, 12, 71, 185, 254, 15, 224, 113, 12, 135, 209, 252, 68, 52, 227, 227, 251, 41, 32, 0, 5, 0, 136, 96, 15, 153, 58, 200, 37, 244, 63, 247, 255, 127, 248, 255, 143, 235, 253, 61, 67, 252, 55, 96, 173, 114, 230, 6, 188, 239, 175, 227, 224, 30, 77, 255, 223, 248, 79, 180, 227, 193, 227, 193, 138, 21, 121, 120, 41, 7, 0, 96, 84, 238, 159, 115, 235, 181, 128, 119, 139, 9, 73, 124, 120, 0, 227, 95, 83, 57, 251, 143, 240, 122, 89, 254, 131, 255, 199, 64, 133, 253, 95, 247, 253, 15, 242, 255, 15, 131, 248, 63, 247, 254, 143, 192, 108, 168, 206, 95, 145, 6, 32, 128, 14, 1, 224, 126, 63, 194, 124, 35, 224, 31, 13},
	{6, 232, 252, 1, 224, 62, 2, 239, 60, 248, 15, 4, 192, 56, 31, 7, 193, 216, 248, 62, 7, 128, 62, 130, 216, 120, 5, 4, 8, 64, 128, 63, 199, 255, 127, 199, 110, 124, 126, 235, 248, 63, 36, 230, 146, 198, 46, 22, 42, 126, 13, 3, 241, 4, 6, 35, 18, 64, 171, 15, 188, 95, 192, 182, 20, 33, 194, 62, 48, 222, 159, 221, 219, 255, 131, 0, 116, 119, 243, 202, 72, 0, 0, 0, 8, 0, 4, 89, 244, 1, 8, 0, 112, 248, 7, 207, 255, 245, 237, 88, 7, 133, 248, 189, 87, 255, 99, 178, 122, 127, 31, 64, 56, 3, 128, 152, 19, 196, 246, 127, 255, 247, 255, 247, 208, 113, 15, 15, 195, 254, 1, 224, 76, 5, 254, 127, 139, 208, 56, 139, 33, 16, 144, 15, 125, 102, 193, 49, 250, 23, 1, 252, 63, 3, 248, 63, 108, 254, 20, 10, 7, 254, 204, 25, 96, 255, 136, 129, 131, 240, 220, 157, 169, 218, 249, 39, 132, 224, 248, 255, 60, 40, 64, 31, 195, 252, 254, 207, 196, 224, 64, 4, 128, 0, 1, 156, 27, 199, 31, 230, 7, 96, 31, 138, 252, 15, 192, 196, 12, 64, 196, 20, 252, 255, 9, 128, 7, 88, 132, 48, 255, 159, 105, 248, 193, 8, 16, 131, 142, 49, 255, 125, 230, 0, 2, 8, 192, 189, 71, 130, 62, 113, 247, 31, 175, 199, 112, 235, 252, 54, 104, 126, 174, 163, 1, 166, 7, 248, 254, 231, 174, 82, 228, 12, 227, 194, 0, 159, 11, 175, 46, 211, 96, 249, 252, 31, 0, 120, 83, 15, 238, 222, 252, 231, 140, 225, 2, 0}
};


template <typename T>
T pop_stream(ap_axiu <sizeof(T)*8,4,5,5> const &e)
{
#pragma HLS INLINE

	assert(sizeof(T) == sizeof(uint16_t) or sizeof(uint8_t)); // It will only support a dtype of 32bits (4bytes)
	union
	{
		int ival;
		T oval;
	} converter;
	converter.ival = e.data;
	T ret = converter.oval;

	volatile ap_uint<sizeof(T)> strb = e.strb;
	volatile ap_uint<sizeof(T)> keep = e.keep;
	volatile ap_uint<4> user = e.user; // 2
	volatile ap_uint<1> last = e.last;
	volatile ap_uint<5> id = e.id;
	volatile ap_uint<5> dest = e.dest;

	return ret;
}

template <typename T> ap_axiu <sizeof(T)*8,4,5,5> push_stream(T const &v, bool last = false)
{
#pragma HLS INLINE
	ap_axiu<sizeof(T)*8,4,5,5> e; // 

	assert(sizeof(T) == sizeof(int16_t) or sizeof(uint8_t));
	union
	{
		int oval;
		T ival;
	} converter;
	converter.ival = v;
	e.data = converter.oval;

	// set it to sizeof(T) ones
	e.strb = -1;
	e.keep = 15; //e.strb;
	e.user = 0;
	e.last = last ? 1 : 0;
	e.id = 0;
	e.dest = 0;
	return e;
}

// you can use the template as follows.
// in_matrix[i][j] = pop_stream<float>(in_matrix[k]);
